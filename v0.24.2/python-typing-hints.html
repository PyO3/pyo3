<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Appendix C: Python typing hints - PyO3 user guide</title>


        <!-- Custom HTML head -->

        <meta name="description" content="PyO3 user guide">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/tabs.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">PyO3 user guide</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/PyO3/pyo3/tree/main/guide" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/PyO3/pyo3/edit/main/guide/src/python-typing-hints.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="typing-and-ide-hints-for-your-python-package"><a class="header" href="#typing-and-ide-hints-for-your-python-package">Typing and IDE hints for your Python package</a></h1>
<p>PyO3 provides an easy to use interface to code native Python libraries in Rust. The accompanying Maturin allows you to build and publish them as a package. Yet, for a better user experience, Python libraries should provide typing hints and documentation for all public entities, so that IDEs can show them during development and type analyzing tools such as <code>mypy</code> can use them to properly verify the code.</p>
<p>Currently the best solution for the problem is to manually maintain <code>*.pyi</code> files and ship them along with the package.</p>
<p>There is a sketch of a roadmap towards completing <a href="./features.html#experimental-inspect">the <code>experimental-inspect</code> feature</a> which may eventually lead to automatic type annotations generated by PyO3. This needs more testing and implementation, please see <a href="https://github.com/PyO3/pyo3/issues/2454">issue #2454</a>.</p>
<h2 id="introduction-to-pyi-files"><a class="header" href="#introduction-to-pyi-files">Introduction to <code>pyi</code> files</a></h2>
<p><code>pyi</code> files (an abbreviation for <code>Python Interface</code>) are called "stub files" in most of the documentation related to them. A very good definition of what it is can be found in <a href="https://github.com/python/mypy/wiki/Creating-Stubs-For-Python-Modules">old MyPy documentation</a>:</p>
<blockquote>
<p>A stubs file only contains a description of the public interface of the module without any implementations.</p>
</blockquote>
<p>There is also <a href="https://typing.readthedocs.io/en/latest/source/stubs.html">extensive documentation on type stubs on the official Python typing documentation</a>.</p>
<p>Most Python developers probably already encountered them when trying to use their IDE's "Go to Definition" function on any builtin type. For example, the definitions of a few standard exceptions look like this:</p>
<pre><code class="language-python">class BaseException(object):
    args: Tuple[Any, ...]
    __cause__: BaseException | None
    __context__: BaseException | None
    __suppress_context__: bool
    __traceback__: TracebackType | None
    def __init__(self, *args: object) -&gt; None: ...
    def __str__(self) -&gt; str: ...
    def __repr__(self) -&gt; str: ...
    def with_traceback(self: _TBE, tb: TracebackType | None) -&gt; _TBE: ...

class SystemExit(BaseException):
    code: int

class Exception(BaseException): ...

class StopIteration(Exception):
    value: Any
</code></pre>
<p>As we can see, those are not full definitions containing implementation, but just a description of the interface. It is usually all that the user of the library needs.</p>
<h3 id="what-do-the-peps-say"><a class="header" href="#what-do-the-peps-say">What do the PEPs say?</a></h3>
<p>At the time of writing this documentation, the <code>pyi</code> files are referenced in three PEPs.</p>
<p><a href="https://www.python.org/dev/peps/pep-0008/#function-annotations">PEP8 - Style Guide for Python Code - #Function Annotations</a> (last point) recommends all third party library creators to provide stub files as the source of knowledge about the package for type checker tools.</p>
<blockquote>
<p>(...) it is expected that users of third party library packages may want to run type checkers over those packages. For this purpose <a href="https://www.python.org/dev/peps/pep-0484">PEP 484</a> recommends the use of stub files: .pyi files that are read by the type checker in preference of the corresponding .py files. (...)</p>
</blockquote>
<p><a href="https://www.python.org/dev/peps/pep-0484/#stub-files">PEP484 - Type Hints - #Stub Files</a> defines stub files as follows.</p>
<blockquote>
<p>Stub files are files containing type hints that are only for use by the type checker, not at runtime.</p>
</blockquote>
<p>It contains a specification for them (highly recommended reading, since it contains at least one thing that is not used in normal Python code) and also some general information about where to store the stub files.</p>
<p><a href="https://www.python.org/dev/peps/pep-0561/">PEP561 - Distributing and Packaging Type Information</a> describes in detail how to build packages that will enable type checking. In particular it contains information about how the stub files must be distributed in order for type checkers to use them.</p>
<h2 id="how-to-do-it"><a class="header" href="#how-to-do-it">How to do it?</a></h2>
<p><a href="https://www.python.org/dev/peps/pep-0561/">PEP561</a> recognizes three ways of distributing type information:</p>
<ul>
<li><code>inline</code> - the typing is placed directly in source (<code>py</code>) files;</li>
<li><code>separate package with stub files</code> - the typing is placed in <code>pyi</code> files distributed in their own, separate package;</li>
<li><code>in-package stub files</code> - the typing is placed in <code>pyi</code> files distributed in the same package as source files.</li>
</ul>
<p>The first way is tricky with PyO3 since we do not have <code>py</code> files. When it has been investigated and necessary changes are implemented, this document will be updated.</p>
<p>The second way is easy to do, and the whole work can be fully separated from the main library code. The example repo for the package with stub files can be found in <a href="https://www.python.org/dev/peps/pep-0561/#references">PEP561 references section</a>: <a href="https://github.com/ethanhs/stub-package">Stub package repository</a></p>
<p>The third way is described below.</p>
<h3 id="including-pyi-files-in-your-pyo3maturin-build-package"><a class="header" href="#including-pyi-files-in-your-pyo3maturin-build-package">Including <code>pyi</code> files in your PyO3/Maturin build package</a></h3>
<p>When source files are in the same package as stub files, they should be placed next to each other. We need a way to do that with Maturin. Also, in order to mark our package as typing-enabled we need to add an empty file named <code>py.typed</code> to the package.</p>
<h4 id="if-you-do-not-have-other-python-files"><a class="header" href="#if-you-do-not-have-other-python-files">If you do not have other Python files</a></h4>
<p>If you do not need to add any other Python files apart from <code>pyi</code> to the package, Maturin provides a way to do most of the work for you. As documented in the <a href="https://github.com/PyO3/maturin/#mixed-rustpython-projects">Maturin Guide</a>, the only thing you need to do is to create a stub file for your module named <code>&lt;module_name&gt;.pyi</code> in your project root and Maturin will do the rest.</p>
<pre><code class="language-text">my-rust-project/
├── Cargo.toml
├── my_project.pyi  # &lt;&lt;&lt; add type stubs for Rust functions in the my_project module here
├── pyproject.toml
└── src
    └── lib.rs
</code></pre>
<p>For an example <code>pyi</code> file see the <a href="#my_projectpyi-content"><code>my_project.pyi</code> content</a> section.</p>
<h4 id="if-you-need-other-python-files"><a class="header" href="#if-you-need-other-python-files">If you need other Python files</a></h4>
<p>If you need to add other Python files apart from <code>pyi</code> to the package, you can do it also, but that requires some more work. Maturin provides an easy way to add files to a package (<a href="https://github.com/PyO3/maturin/blob/0dee40510083c03607834c821eea76964140a126/Readme.md#mixed-rustpython-projects">documentation</a>). You just need to create a folder with the name of your module next to the <code>Cargo.toml</code> file (for customization see documentation linked above).</p>
<p>The folder structure would be:</p>
<pre><code class="language-text">my-project
├── Cargo.toml
├── my_project
│   ├── __init__.py
│   ├── my_project.pyi
│   ├── other_python_file.py
│   └── py.typed
├── pyproject.toml
├── Readme.md
└── src
    └── lib.rs
</code></pre>
<p>Let's go a little bit more into detail regarding the files inside the package folder.</p>
<h5 id="__init__py-content"><a class="header" href="#__init__py-content"><code>__init__.py</code> content</a></h5>
<p>As we now specify our own package content, we have to provide the <code>__init__.py</code> file, so the folder is treated as a package and we can import things from it. We can always use the same content that Maturin creates for us if we do not specify a Python source folder. For PyO3 bindings it would be:</p>
<pre><code class="language-python">from .my_project import *
</code></pre>
<p>That way everything that is exposed by our native module can be imported directly from the package.</p>
<h5 id="pytyped-requirement"><a class="header" href="#pytyped-requirement"><code>py.typed</code> requirement</a></h5>
<p>As stated in <a href="https://www.python.org/dev/peps/pep-0561/">PEP561</a>:</p>
<blockquote>
<p>Package maintainers who wish to support type checking of their code MUST add a marker file named py.typed to their package supporting typing. This marker applies recursively: if a top-level package includes it, all its sub-packages MUST support type checking as well.</p>
</blockquote>
<p>If we do not include that file, some IDEs might still use our <code>pyi</code> files to show hints, but the type checkers might not. MyPy will raise an error in this situation:</p>
<pre><code class="language-text">error: Skipping analyzing "my_project": found module but no type hints or library stubs
</code></pre>
<p>The file is just a marker file, so it should be empty.</p>
<h5 id="my_projectpyi-content"><a class="header" href="#my_projectpyi-content"><code>my_project.pyi</code> content</a></h5>
<p>Our module stub file. This document does not aim at describing how to write them, since you can find a lot of documentation on it, starting from the already quoted <a href="https://www.python.org/dev/peps/pep-0484/#stub-files">PEP484</a>.</p>
<p>The example can look like this:</p>
<pre><code class="language-python">class Car:
    """
    A class representing a car.

    :param body_type: the name of body type, e.g. hatchback, sedan
    :param horsepower: power of the engine in horsepower
    """
    def __init__(self, body_type: str, horsepower: int) -&gt; None: ...

    @classmethod
    def from_unique_name(cls, name: str) -&gt; 'Car':
        """
        Creates a Car based on unique name

        :param name: model name of a car to be created
        :return: a Car instance with default data
        """

    def best_color(self) -&gt; str:
        """
        Gets the best color for the car.

        :return: the name of the color our great algorithm thinks is the best for this car
        """
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="trait-bounds.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="changelog.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="trait-bounds.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="changelog.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="theme/tabs.js"></script>


    </div>
    </body>
</html>
