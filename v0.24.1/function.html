<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Python functions - PyO3 user guide</title>


        <!-- Custom HTML head -->

        <meta name="description" content="PyO3 user guide">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/tabs.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">PyO3 user guide</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/PyO3/pyo3/tree/main/guide" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/PyO3/pyo3/edit/main/guide/src/function.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="python-functions"><a class="header" href="#python-functions">Python functions</a></h1>
<p>The <code>#[pyfunction]</code> attribute is used to define a Python function from a Rust function. Once defined, the function needs to be added to a <a href="./module.html">module</a> using the <code>wrap_pyfunction!</code> macro.</p>
<p>The following example defines a function called <code>double</code> in a Python module called <code>my_extension</code>:</p>
<pre><code class="language-rust">use pyo3::prelude::*;

#[pyfunction]
fn double(x: usize) -&gt; usize {
    x * 2
}

#[pymodule]
fn my_extension(m: &amp;Bound&lt;'_, PyModule&gt;) -&gt; PyResult&lt;()&gt; {
    m.add_function(wrap_pyfunction!(double, m)?)
}</code></pre>
<p>This chapter of the guide explains full usage of the <code>#[pyfunction]</code> attribute. In this first section, the following topics are covered:</p>
<ul>
<li><a href="#function-options">Function options</a>
<ul>
<li><a href="#name"><code>#[pyo3(name = "...")]</code></a></li>
<li><a href="#signature"><code>#[pyo3(signature = (...))]</code></a></li>
<li><a href="#text_signature"><code>#[pyo3(text_signature = "...")]</code></a></li>
<li><a href="#pass_module"><code>#[pyo3(pass_module)]</code></a></li>
</ul>
</li>
<li><a href="#per-argument-options">Per-argument options</a></li>
<li><a href="#advanced-function-patterns">Advanced function patterns</a></li>
<li><a href="#pyfn-shorthand"><code>#[pyfn]</code> shorthand</a></li>
</ul>
<p>There are also additional sections on the following topics:</p>
<ul>
<li><a href="./function/signature.html">Function Signatures</a></li>
</ul>
<h2 id="function-options"><a class="header" href="#function-options">Function options</a></h2>
<p>The <code>#[pyo3]</code> attribute can be used to modify properties of the generated Python function. It can take any combination of the following options:</p>
<ul>
<li>
<p><a id="name"></a> <code>#[pyo3(name = "...")]</code></p>
<p>Overrides the name exposed to Python.</p>
<p>In the following example, the Rust function <code>no_args_py</code> will be added to the Python module
<code>module_with_functions</code> as the Python function <code>no_args</code>:</p>
<pre><code class="language-rust">use pyo3::prelude::*;

#[pyfunction]
#[pyo3(name = "no_args")]
fn no_args_py() -&gt; usize {
    42
}

#[pymodule]
fn module_with_functions(m: &amp;Bound&lt;'_, PyModule&gt;) -&gt; PyResult&lt;()&gt; {
    m.add_function(wrap_pyfunction!(no_args_py, m)?)
}

<span class="boring">Python::with_gil(|py| {
</span><span class="boring">    let m = pyo3::wrap_pymodule!(module_with_functions)(py);
</span><span class="boring">    assert!(m.getattr(py, "no_args").is_ok());
</span><span class="boring">    assert!(m.getattr(py, "no_args_py").is_err());
</span><span class="boring">});</span></code></pre>
</li>
<li>
<p><a id="signature"></a> <code>#[pyo3(signature = (...))]</code></p>
<p>Defines the function signature in Python. See <a href="./function/signature.html">Function Signatures</a>.</p>
</li>
<li>
<p><a id="text_signature"></a> <code>#[pyo3(text_signature = "...")]</code></p>
<p>Overrides the PyO3-generated function signature visible in Python tooling (such as via <a href="https://docs.python.org/3/library/inspect.html#inspect.signature"><code>inspect.signature</code></a>). See the <a href="./function/signature.html#making-the-function-signature-available-to-python">corresponding topic in the Function Signatures subchapter</a>.</p>
</li>
<li>
<p><a id="pass_module" ></a> <code>#[pyo3(pass_module)]</code></p>
<p>Set this option to make PyO3 pass the containing module as the first argument to the function. It is then possible to use the module in the function body. The first argument <strong>must</strong> be of type <code>&amp;Bound&lt;'_, PyModule&gt;</code>, <code>Bound&lt;'_, PyModule&gt;</code>, or <code>Py&lt;PyModule&gt;</code>.</p>
<p>The following example creates a function <code>pyfunction_with_module</code> which returns the containing module's name (i.e. <code>module_with_fn</code>):</p>
<pre><code class="language-rust">use pyo3::prelude::*;
use pyo3::types::PyString;

#[pyfunction]
#[pyo3(pass_module)]
fn pyfunction_with_module&lt;'py&gt;(
    module: &amp;Bound&lt;'py, PyModule&gt;,
) -&gt; PyResult&lt;Bound&lt;'py, PyString&gt;&gt; {
    module.name()
}

#[pymodule]
fn module_with_fn(m: &amp;Bound&lt;'_, PyModule&gt;) -&gt; PyResult&lt;()&gt; {
    m.add_function(wrap_pyfunction!(pyfunction_with_module, m)?)
}</code></pre>
</li>
</ul>
<h2 id="per-argument-options"><a class="header" href="#per-argument-options">Per-argument options</a></h2>
<p>The <code>#[pyo3]</code> attribute can be used on individual arguments to modify properties of them in the generated function. It can take any combination of the following options:</p>
<ul>
<li>
<p><a id="from_py_with"></a> <code>#[pyo3(from_py_with = ...)]</code></p>
<p>Set this on an option to specify a custom function to convert the function argument from Python to the desired Rust type, instead of using the default <code>FromPyObject</code> extraction. The function signature must be <code>fn(&amp;Bound&lt;'_, PyAny&gt;) -&gt; PyResult&lt;T&gt;</code> where <code>T</code> is the Rust type of the argument.</p>
<p>The following example uses <code>from_py_with</code> to convert the input Python object to its length:</p>
<pre><code class="language-rust">use pyo3::prelude::*;

fn get_length(obj: &amp;Bound&lt;'_, PyAny&gt;) -&gt; PyResult&lt;usize&gt; {
    obj.len()
}

#[pyfunction]
fn object_length(#[pyo3(from_py_with = get_length)] argument: usize) -&gt; usize {
    argument
}

<span class="boring">Python::with_gil(|py| {
</span><span class="boring">    let f = pyo3::wrap_pyfunction!(object_length)(py).unwrap();
</span><span class="boring">    assert_eq!(f.call1((vec![1, 2, 3],)).unwrap().extract::&lt;usize&gt;().unwrap(), 3);
</span><span class="boring">});</span></code></pre>
</li>
</ul>
<h2 id="advanced-function-patterns"><a class="header" href="#advanced-function-patterns">Advanced function patterns</a></h2>
<h3 id="calling-python-functions-in-rust"><a class="header" href="#calling-python-functions-in-rust">Calling Python functions in Rust</a></h3>
<p>You can pass Python <code>def</code>'d functions and built-in functions to Rust functions <a href="https://docs.rs/pyo3/0.24.1/pyo3/types/struct.PyFunction.html"><code>PyFunction</code></a>
corresponds to regular Python functions while <a href="https://docs.rs/pyo3/0.24.1/pyo3/types/struct.PyCFunction.html"><code>PyCFunction</code></a> describes built-ins such as
<code>repr()</code>.</p>
<p>You can also use <a href="https://docs.rs/pyo3/0.24.1/pyo3/prelude/trait.PyAnyMethods.html#tymethod.is_callable"><code>Bound&lt;'_, PyAny&gt;::is_callable</code></a> to check if you have a callable object. <code>is_callable</code>
will return <code>true</code> for functions (including lambdas), methods and objects with a <code>__call__</code> method.
You can call the object with <a href="https://docs.rs/pyo3/0.24.1/pyo3/prelude/trait.PyAnyMethods.html#tymethod.call"><code>Bound&lt;'_, PyAny&gt;::call</code></a> with the args as first parameter and the kwargs
(or <code>None</code>) as second parameter. There are also <a href="https://docs.rs/pyo3/0.24.1/pyo3/prelude/trait.PyAnyMethods.html#tymethod.call0"><code>Bound&lt;'_, PyAny&gt;::call0</code></a> with no args and
<a href="https://docs.rs/pyo3/0.24.1/pyo3/prelude/trait.PyAnyMethods.html#tymethod.call1"><code>Bound&lt;'_, PyAny&gt;::call1</code></a> with only positional args.</p>
<h3 id="calling-rust-functions-in-python"><a class="header" href="#calling-rust-functions-in-python">Calling Rust functions in Python</a></h3>
<p>The ways to convert a Rust function into a Python object vary depending on the function:</p>
<ul>
<li>Named functions, e.g. <code>fn foo()</code>: add <code>#[pyfunction]</code> and then use <a href="https://docs.rs/pyo3/0.24.1/pyo3/macro.wrap_pyfunction.html"><code>wrap_pyfunction!</code></a> to get the corresponding <a href="https://docs.rs/pyo3/0.24.1/pyo3/types/struct.PyCFunction.html"><code>PyCFunction</code></a>.</li>
<li>Anonymous functions (or closures), e.g. <code>foo: fn()</code> either:
<ul>
<li>use a <code>#[pyclass]</code> struct which stores the function as a field and implement <code>__call__</code> to call the stored function.</li>
<li>use <code>PyCFunction::new_closure</code> to create an object directly from the function.</li>
</ul>
</li>
</ul>
<h3 id="accessing-the-ffi-functions"><a class="header" href="#accessing-the-ffi-functions">Accessing the FFI functions</a></h3>
<p>In order to make Rust functions callable from Python, PyO3 generates an <code>extern "C"</code>
function whose exact signature depends on the Rust signature.  (PyO3 chooses the optimal
Python argument passing convention.) It then embeds the call to the Rust function inside this
FFI-wrapper function. This wrapper handles extraction of the regular arguments and the keyword
arguments from the input <code>PyObject</code>s.</p>
<p>The <code>wrap_pyfunction</code> macro can be used to directly get a <code>Bound&lt;PyCFunction&gt;</code> given a
<code>#[pyfunction]</code> and a <code>Bound&lt;PyModule&gt;</code>: <code>wrap_pyfunction!(rust_fun, module)</code>.</p>
<h2 id="pyfn-shorthand"><a class="header" href="#pyfn-shorthand"><code>#[pyfn]</code> shorthand</a></h2>
<p>There is a shorthand to <code>#[pyfunction]</code> and <code>wrap_pymodule!</code>: the function can be placed inside the module definition and
annotated with <code>#[pyfn]</code>. To simplify PyO3, it is expected that <code>#[pyfn]</code> may be removed in a future release (See <a href="https://github.com/PyO3/pyo3/issues/694">#694</a>).</p>
<p>An example of <code>#[pyfn]</code> is below:</p>
<pre><code class="language-rust">use pyo3::prelude::*;

#[pymodule]
fn my_extension(m: &amp;Bound&lt;'_, PyModule&gt;) -&gt; PyResult&lt;()&gt; {
    #[pyfn(m)]
    fn double(x: usize) -&gt; usize {
        x * 2
    }

    Ok(())
}</code></pre>
<p><code>#[pyfn(m)]</code> is just syntactic sugar for <code>#[pyfunction]</code>, and takes all the same options
documented in the rest of this chapter. The code above is expanded to the following:</p>
<pre><code class="language-rust">use pyo3::prelude::*;

#[pymodule]
fn my_extension(m: &amp;Bound&lt;'_, PyModule&gt;) -&gt; PyResult&lt;()&gt; {
    #[pyfunction]
    fn double(x: usize) -&gt; usize {
        x * 2
    }

    m.add_function(wrap_pyfunction!(double, m)?)
}</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="module.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="function/signature.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="module.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="function/signature.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="theme/tabs.js"></script>


    </div>
    </body>
</html>
