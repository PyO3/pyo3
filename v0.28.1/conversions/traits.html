<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Conversion traits - PyO3 user guide</title>


        <!-- Custom HTML head -->

        <meta name="description" content="PyO3 user guide">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../css/variables-8adf115d.css">
        <link rel="stylesheet" href="../css/general-2459343d.css">
        <link rel="stylesheet" href="../css/chrome-ae938929.css">
        <link rel="stylesheet" href="../css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="../highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="../ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../theme/tabs-52f01167.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex-f5903ddc.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc-4c684194.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">PyO3 user guide</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/PyO3/pyo3/tree/main/guide" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>
                        <a href="https://github.com/PyO3/pyo3/edit/main/guide/src/conversions/traits.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <span class=fa-svg id="git-edit-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M421.7 220.3l-11.3 11.3-22.6 22.6-205 205c-6.6 6.6-14.8 11.5-23.8 14.1L30.8 511c-8.4 2.5-17.5 .2-23.7-6.1S-1.5 489.7 1 481.2L38.7 353.1c2.6-9 7.5-17.2 14.1-23.8l205-205 22.6-22.6 11.3-11.3 33.9 33.9 62.1 62.1 33.9 33.9zM96 353.9l-9.3 9.3c-.9 .9-1.6 2.1-2 3.4l-25.3 86 86-25.3c1.3-.4 2.5-1.1 3.4-2l9.3-9.3H112c-8.8 0-16-7.2-16-16V353.9zM453.3 19.3l39.4 39.4c25 25 25 65.5 0 90.5l-14.5 14.5-22.6 22.6-11.3 11.3-33.9-33.9-62.1-62.1L314.3 67.7l11.3-11.3 22.6-22.6 14.5-14.5c25-25 65.5-25 90.5 0z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="conversion-traits"><a class="header" href="#conversion-traits">Conversion traits</a></h1>
<p>PyO3 provides some handy traits to convert between Python types and Rust types.</p>
<h2 id="extract-and-the-frompyobject-trait"><a class="header" href="#extract-and-the-frompyobject-trait"><code>.extract()</code> and the <code>FromPyObject</code> trait</a></h2>
<p>The easiest way to convert a Python object to a Rust value is using <code>.extract()</code>.
It returns a <code>PyResult</code> with a type error if the conversion fails, so usually you will use something like</p>
<pre><code class="language-rust"><span class="boring">use pyo3::prelude::*;
</span><span class="boring">use pyo3::types::PyList;
</span><span class="boring">fn main() -&gt; PyResult&lt;()&gt; {
</span><span class="boring">    Python::attach(|py| {
</span><span class="boring">        let list = PyList::new(py, b"foo")?;
</span>let v: Vec&lt;i32&gt; = list.extract()?;
<span class="boring">        assert_eq!(&amp;v, &amp;[102, 111, 111]);
</span><span class="boring">        Ok(())
</span><span class="boring">    })
</span><span class="boring">}</span></code></pre>
<p>This method is available for many Python object types, and can produce a wide variety of Rust types, which you can check out in the implementor list of <a href="https://docs.rs/pyo3/0.28.1/pyo3/conversion/trait.FromPyObject.html"><code>FromPyObject</code></a>.</p>
<p><a href="https://docs.rs/pyo3/0.28.1/pyo3/conversion/trait.FromPyObject.html"><code>FromPyObject</code></a> is also implemented for your own Rust types wrapped as Python objects (see <a href="../class.html">the chapter about classes</a>).
There, in order to both be able to operate on mutable references <em>and</em> satisfy Rust’s rules of non-aliasing mutable references, you have to extract the PyO3 reference wrappers <a href="https://docs.rs/pyo3/0.28.1/pyo3/pycell/struct.PyRef.html"><code>PyRef</code></a> and <a href="https://docs.rs/pyo3/0.28.1/pyo3/pycell/struct.PyRefMut.html"><code>PyRefMut</code></a>.
They work like the reference wrappers of <code>std::cell::RefCell</code> and ensure (at runtime) that Rust borrows are allowed.</p>
<h3 id="deriving-frompyobject"><a class="header" href="#deriving-frompyobject">Deriving <a href="https://docs.rs/pyo3/0.28.1/pyo3/conversion/trait.FromPyObject.html"><code>FromPyObject</code></a></a></h3>
<p><a href="https://docs.rs/pyo3/0.28.1/pyo3/conversion/trait.FromPyObject.html"><code>FromPyObject</code></a> can be automatically derived for many kinds of structs and enums if the member types themselves implement <code>FromPyObject</code>.
This even includes members with a generic type <code>T: FromPyObject</code>.
Derivation for empty enums, enum variants and structs is not supported.</p>
<h3 id="deriving-frompyobject-for-structs"><a class="header" href="#deriving-frompyobject-for-structs">Deriving <a href="https://docs.rs/pyo3/0.28.1/pyo3/conversion/trait.FromPyObject.html"><code>FromPyObject</code></a> for structs</a></h3>
<p>The derivation generates code that will attempt to access the attribute  <code>my_string</code> on the Python object, i.e. <code>obj.getattr("my_string")</code>, and call <code>extract()</code> on the attribute.</p>
<pre><code class="language-rust">use pyo3::prelude::*;

#[derive(FromPyObject)]
struct RustyStruct {
    my_string: String,
}
<span class="boring">
</span><span class="boring">fn main() -&gt; PyResult&lt;()&gt; {
</span><span class="boring">    Python::attach(|py| -&gt; PyResult&lt;()&gt; {
</span><span class="boring">        let module = PyModule::from_code(
</span><span class="boring">            py,
</span><span class="boring">            c"class Foo:
</span><span class="boring">            def __init__(self):
</span><span class="boring">                self.my_string = 'test'",
</span><span class="boring">            c"&lt;string&gt;",
</span><span class="boring">            c"",
</span><span class="boring">        )?;
</span><span class="boring">
</span><span class="boring">        let class = module.getattr("Foo")?;
</span><span class="boring">        let instance = class.call0()?;
</span><span class="boring">        let rustystruct: RustyStruct = instance.extract()?;
</span><span class="boring">        assert_eq!(rustystruct.my_string, "test");
</span><span class="boring">        Ok(())
</span><span class="boring">    })
</span><span class="boring">}</span></code></pre>
<p>By setting the <code>#[pyo3(item)]</code> attribute on the field, PyO3 will attempt to extract the value by calling the <code>get_item</code> method on the Python object.</p>
<pre><code class="language-rust">use pyo3::prelude::*;

#[derive(FromPyObject)]
struct RustyStruct {
    #[pyo3(item)]
    my_string: String,
}
<span class="boring">
</span><span class="boring">use pyo3::types::PyDict;
</span><span class="boring">fn main() -&gt; PyResult&lt;()&gt; {
</span><span class="boring">    Python::attach(|py| -&gt; PyResult&lt;()&gt; {
</span><span class="boring">        let dict = PyDict::new(py);
</span><span class="boring">        dict.set_item("my_string", "test")?;
</span><span class="boring">
</span><span class="boring">        let rustystruct: RustyStruct = dict.extract()?;
</span><span class="boring">        assert_eq!(rustystruct.my_string, "test");
</span><span class="boring">        Ok(())
</span><span class="boring">    })
</span><span class="boring">}</span></code></pre>
<p>The argument passed to <code>getattr</code> and <code>get_item</code> can also be configured:</p>
<pre><code class="language-rust">use pyo3::prelude::*;

#[derive(FromPyObject)]
struct RustyStruct {
    #[pyo3(item("key"))]
    string_in_mapping: String,
    #[pyo3(attribute("name"))]
    string_attr: String,
}
<span class="boring">
</span><span class="boring">fn main() -&gt; PyResult&lt;()&gt; {
</span><span class="boring">    Python::attach(|py| -&gt; PyResult&lt;()&gt; {
</span><span class="boring">        let module = PyModule::from_code(
</span><span class="boring">            py,
</span><span class="boring">            c"class Foo(dict):
</span><span class="boring">            def __init__(self):
</span><span class="boring">                self.name = 'test'
</span><span class="boring">                self['key'] = 'test2'",
</span><span class="boring">            c"&lt;string&gt;",
</span><span class="boring">            c"",
</span><span class="boring">        )?;
</span><span class="boring">
</span><span class="boring">        let class = module.getattr("Foo")?;
</span><span class="boring">        let instance = class.call0()?;
</span><span class="boring">        let rustystruct: RustyStruct = instance.extract()?;
</span><span class="boring">		assert_eq!(rustystruct.string_attr, "test");
</span><span class="boring">        assert_eq!(rustystruct.string_in_mapping, "test2");
</span><span class="boring">
</span><span class="boring">        Ok(())
</span><span class="boring">    })
</span><span class="boring">}</span></code></pre>
<p>This tries to extract <code>string_attr</code> from the attribute <code>name</code> and <code>string_in_mapping</code> from a mapping with the key <code>"key"</code>.
The arguments for <code>attribute</code> are restricted to non-empty string literals while <code>item</code> can take any valid literal that implements <code>ToBorrowedObject</code>.</p>
<p>You can use <code>#[pyo3(from_item_all)]</code> on a struct to extract every field with <code>get_item</code> method.
In this case, you can’t use <code>#[pyo3(attribute)]</code> or barely use <code>#[pyo3(item)]</code> on any field.
However, using <code>#[pyo3(item("key"))]</code> to specify the key for a field is still allowed.</p>
<pre><code class="language-rust">use pyo3::prelude::*;

#[derive(FromPyObject)]
#[pyo3(from_item_all)]
struct RustyStruct {
    foo: String,
    bar: String,
    #[pyo3(item("foobar"))]
    baz: String,
}
<span class="boring">
</span><span class="boring">fn main() -&gt; PyResult&lt;()&gt; {
</span><span class="boring">    Python::attach(|py| -&gt; PyResult&lt;()&gt; {
</span><span class="boring">        let py_dict = py.eval(c"{'foo': 'foo', 'bar': 'bar', 'foobar': 'foobar'}", None, None)?;
</span><span class="boring">        let rustystruct: RustyStruct = py_dict.extract()?;
</span><span class="boring">		  assert_eq!(rustystruct.foo, "foo");
</span><span class="boring">        assert_eq!(rustystruct.bar, "bar");
</span><span class="boring">        assert_eq!(rustystruct.baz, "foobar");
</span><span class="boring">
</span><span class="boring">        Ok(())
</span><span class="boring">    })
</span><span class="boring">}</span></code></pre>
<h3 id="deriving-frompyobject-for-tuple-structs"><a class="header" href="#deriving-frompyobject-for-tuple-structs">Deriving <a href="https://docs.rs/pyo3/0.28.1/pyo3/conversion/trait.FromPyObject.html"><code>FromPyObject</code></a> for tuple structs</a></h3>
<p>Tuple structs are also supported but do not allow customizing the extraction.
The input is always assumed to be a Python tuple with the same length as the Rust type, the <code>n</code>th field is extracted from the <code>n</code>th item in the Python tuple.</p>
<pre><code class="language-rust">use pyo3::prelude::*;

#[derive(FromPyObject)]
struct RustyTuple(String, String);

<span class="boring">use pyo3::types::PyTuple;
</span><span class="boring">fn main() -&gt; PyResult&lt;()&gt; {
</span><span class="boring">    Python::attach(|py| -&gt; PyResult&lt;()&gt; {
</span><span class="boring">        let tuple = PyTuple::new(py, vec!["test", "test2"])?;
</span><span class="boring">
</span><span class="boring">        let rustytuple: RustyTuple = tuple.extract()?;
</span><span class="boring">        assert_eq!(rustytuple.0, "test");
</span><span class="boring">        assert_eq!(rustytuple.1, "test2");
</span><span class="boring">
</span><span class="boring">        Ok(())
</span><span class="boring">    })
</span><span class="boring">}</span></code></pre>
<p>Tuple structs with a single field are treated as wrapper types which are described in the following section.
To override this behaviour and ensure that the input is in fact a tuple, specify the struct as</p>
<pre><code class="language-rust">use pyo3::prelude::*;

#[derive(FromPyObject)]
struct RustyTuple((String,));

<span class="boring">use pyo3::types::PyTuple;
</span><span class="boring">fn main() -&gt; PyResult&lt;()&gt; {
</span><span class="boring">    Python::attach(|py| -&gt; PyResult&lt;()&gt; {
</span><span class="boring">        let tuple = PyTuple::new(py, vec!["test"])?;
</span><span class="boring">
</span><span class="boring">        let rustytuple: RustyTuple = tuple.extract()?;
</span><span class="boring">        assert_eq!((rustytuple.0).0, "test");
</span><span class="boring">
</span><span class="boring">        Ok(())
</span><span class="boring">    })
</span><span class="boring">}</span></code></pre>
<h3 id="deriving-frompyobject-for-wrapper-types"><a class="header" href="#deriving-frompyobject-for-wrapper-types">Deriving <a href="https://docs.rs/pyo3/0.28.1/pyo3/conversion/trait.FromPyObject.html"><code>FromPyObject</code></a> for wrapper types</a></h3>
<p>The <code>pyo3(transparent)</code> attribute can be used on structs with exactly one field.
This results in extracting directly from the input object, i.e. <code>obj.extract()</code>, rather than trying to access an item or attribute.
This behaviour is enabled per default for newtype structs and tuple-variants with a single field.</p>
<pre><code class="language-rust">use pyo3::prelude::*;

#[derive(FromPyObject)]
struct RustyTransparentTupleStruct(String);

#[derive(FromPyObject)]
#[pyo3(transparent)]
struct RustyTransparentStruct {
    inner: String,
}

<span class="boring">use pyo3::types::PyString;
</span><span class="boring">fn main() -&gt; PyResult&lt;()&gt; {
</span><span class="boring">    Python::attach(|py| -&gt; PyResult&lt;()&gt; {
</span><span class="boring">        let s = PyString::new(py, "test");
</span><span class="boring">
</span><span class="boring">        let tup: RustyTransparentTupleStruct = s.extract()?;
</span><span class="boring">        assert_eq!(tup.0, "test");
</span><span class="boring">
</span><span class="boring">        let stru: RustyTransparentStruct = s.extract()?;
</span><span class="boring">        assert_eq!(stru.inner, "test");
</span><span class="boring">
</span><span class="boring">        Ok(())
</span><span class="boring">    })
</span><span class="boring">}</span></code></pre>
<h3 id="deriving-frompyobject-for-enums"><a class="header" href="#deriving-frompyobject-for-enums">Deriving <a href="https://docs.rs/pyo3/0.28.1/pyo3/conversion/trait.FromPyObject.html"><code>FromPyObject</code></a> for enums</a></h3>
<p>The <code>FromPyObject</code> derivation for enums generates code that tries to extract the variants in the order of the fields.
As soon as a variant can be extracted successfully, that variant is returned.
This makes it possible to extract Python union types like <code>str | int</code>.</p>
<p>The same customizations and restrictions described for struct derivations apply to enum variants, i.e. a tuple variant assumes that the input is a Python tuple, and a struct variant defaults to extracting fields as attributes but can be configured in the same manner.
The <code>transparent</code> attribute can be applied to single-field-variants.</p>
<pre><code class="language-rust">use pyo3::prelude::*;

#[derive(FromPyObject)]
<span class="boring">#[derive(Debug)]
</span>enum RustyEnum&lt;'py&gt; {
    Int(usize),                    // input is a positive int
    String(String),                // input is a string
    IntTuple(usize, usize),        // input is a 2-tuple with positive ints
    StringIntTuple(String, usize), // input is a 2-tuple with String and int
    Coordinates3d {
        // needs to be in front of 2d
        x: usize,
        y: usize,
        z: usize,
    },
    Coordinates2d {
        // only gets checked if the input did not have `z`
        #[pyo3(attribute("x"))]
        a: usize,
        #[pyo3(attribute("y"))]
        b: usize,
    },
    #[pyo3(transparent)]
    CatchAll(Bound&lt;'py, PyAny&gt;), // This extraction never fails
}
<span class="boring">
</span><span class="boring">use pyo3::types::{PyBytes, PyString};
</span><span class="boring">fn main() -&gt; PyResult&lt;()&gt; {
</span><span class="boring">    Python::attach(|py| -&gt; PyResult&lt;()&gt; {
</span><span class="boring">        {
</span><span class="boring">            let thing = 42_u8.into_pyobject(py)?;
</span><span class="boring">            let rust_thing: RustyEnum&lt;'_&gt; = thing.extract()?;
</span><span class="boring">
</span><span class="boring">            assert_eq!(
</span><span class="boring">                42,
</span><span class="boring">                match rust_thing {
</span><span class="boring">                    RustyEnum::Int(i) =&gt; i,
</span><span class="boring">                    other =&gt; unreachable!("Error extracting: {:?}", other),
</span><span class="boring">                }
</span><span class="boring">            );
</span><span class="boring">        }
</span><span class="boring">        {
</span><span class="boring">            let thing = PyString::new(py, "text");
</span><span class="boring">            let rust_thing: RustyEnum&lt;'_&gt; = thing.extract()?;
</span><span class="boring">
</span><span class="boring">            assert_eq!(
</span><span class="boring">                "text",
</span><span class="boring">                match rust_thing {
</span><span class="boring">                    RustyEnum::String(i) =&gt; i,
</span><span class="boring">                    other =&gt; unreachable!("Error extracting: {:?}", other),
</span><span class="boring">                }
</span><span class="boring">            );
</span><span class="boring">        }
</span><span class="boring">        {
</span><span class="boring">            let thing = (32_u8, 73_u8).into_pyobject(py)?;
</span><span class="boring">            let rust_thing: RustyEnum&lt;'_&gt; = thing.extract()?;
</span><span class="boring">
</span><span class="boring">            assert_eq!(
</span><span class="boring">                (32, 73),
</span><span class="boring">                match rust_thing {
</span><span class="boring">                    RustyEnum::IntTuple(i, j) =&gt; (i, j),
</span><span class="boring">                    other =&gt; unreachable!("Error extracting: {:?}", other),
</span><span class="boring">                }
</span><span class="boring">            );
</span><span class="boring">        }
</span><span class="boring">        {
</span><span class="boring">            let thing = ("foo", 73_u8).into_pyobject(py)?;
</span><span class="boring">            let rust_thing: RustyEnum&lt;'_&gt; = thing.extract()?;
</span><span class="boring">
</span><span class="boring">            assert_eq!(
</span><span class="boring">                (String::from("foo"), 73),
</span><span class="boring">                match rust_thing {
</span><span class="boring">                    RustyEnum::StringIntTuple(i, j) =&gt; (i, j),
</span><span class="boring">                    other =&gt; unreachable!("Error extracting: {:?}", other),
</span><span class="boring">                }
</span><span class="boring">            );
</span><span class="boring">        }
</span><span class="boring">        {
</span><span class="boring">            let module = PyModule::from_code(
</span><span class="boring">                py,
</span><span class="boring">                c"class Foo(dict):
</span><span class="boring">            def __init__(self):
</span><span class="boring">                self.x = 0
</span><span class="boring">                self.y = 1
</span><span class="boring">                self.z = 2",
</span><span class="boring">                c"&lt;string&gt;",
</span><span class="boring">                c"",
</span><span class="boring">            )?;
</span><span class="boring">
</span><span class="boring">            let class = module.getattr("Foo")?;
</span><span class="boring">            let instance = class.call0()?;
</span><span class="boring">            let rust_thing: RustyEnum&lt;'_&gt; = instance.extract()?;
</span><span class="boring">
</span><span class="boring">            assert_eq!(
</span><span class="boring">                (0, 1, 2),
</span><span class="boring">                match rust_thing {
</span><span class="boring">                    RustyEnum::Coordinates3d { x, y, z } =&gt; (x, y, z),
</span><span class="boring">                    other =&gt; unreachable!("Error extracting: {:?}", other),
</span><span class="boring">                }
</span><span class="boring">            );
</span><span class="boring">        }
</span><span class="boring">
</span><span class="boring">        {
</span><span class="boring">            let module = PyModule::from_code(
</span><span class="boring">                py,
</span><span class="boring">                c"class Foo(dict):
</span><span class="boring">            def __init__(self):
</span><span class="boring">                self.x = 3
</span><span class="boring">                self.y = 4",
</span><span class="boring">                c"&lt;string&gt;",
</span><span class="boring">                c"",
</span><span class="boring">            )?;
</span><span class="boring">
</span><span class="boring">            let class = module.getattr("Foo")?;
</span><span class="boring">            let instance = class.call0()?;
</span><span class="boring">            let rust_thing: RustyEnum&lt;'_&gt; = instance.extract()?;
</span><span class="boring">
</span><span class="boring">            assert_eq!(
</span><span class="boring">                (3, 4),
</span><span class="boring">                match rust_thing {
</span><span class="boring">                    RustyEnum::Coordinates2d { a, b } =&gt; (a, b),
</span><span class="boring">                    other =&gt; unreachable!("Error extracting: {:?}", other),
</span><span class="boring">                }
</span><span class="boring">            );
</span><span class="boring">        }
</span><span class="boring">
</span><span class="boring">        {
</span><span class="boring">            let thing = PyBytes::new(py, b"text");
</span><span class="boring">            let rust_thing: RustyEnum&lt;'_&gt; = thing.extract()?;
</span><span class="boring">
</span><span class="boring">            assert_eq!(
</span><span class="boring">                b"text",
</span><span class="boring">                match rust_thing {
</span><span class="boring">                    RustyEnum::CatchAll(ref i) =&gt; i.cast::&lt;PyBytes&gt;()?.as_bytes(),
</span><span class="boring">                    other =&gt; unreachable!("Error extracting: {:?}", other),
</span><span class="boring">                }
</span><span class="boring">            );
</span><span class="boring">        }
</span><span class="boring">        Ok(())
</span><span class="boring">    })
</span><span class="boring">}</span></code></pre>
<p>If none of the enum variants match, a <code>PyTypeError</code> containing the names of the tested variants is returned.
The names reported in the error message can be customized through the <code>#[pyo3(annotation = "name")]</code> attribute, e.g. to use conventional Python type names:</p>
<pre><code class="language-rust">use pyo3::prelude::*;

#[derive(FromPyObject)]
<span class="boring">#[derive(Debug)]
</span>enum RustyEnum {
    #[pyo3(transparent, annotation = "str")]
    String(String),
    #[pyo3(transparent, annotation = "int")]
    Int(isize),
}
<span class="boring">
</span><span class="boring">fn main() -&gt; PyResult&lt;()&gt; {
</span><span class="boring">    Python::attach(|py| -&gt; PyResult&lt;()&gt; {
</span><span class="boring">        {
</span><span class="boring">            let thing = 42_u8.into_pyobject(py)?;
</span><span class="boring">            let rust_thing: RustyEnum = thing.extract()?;
</span><span class="boring">
</span><span class="boring">            assert_eq!(
</span><span class="boring">                42,
</span><span class="boring">                match rust_thing {
</span><span class="boring">                    RustyEnum::Int(i) =&gt; i,
</span><span class="boring">                    other =&gt; unreachable!("Error extracting: {:?}", other),
</span><span class="boring">                }
</span><span class="boring">            );
</span><span class="boring">        }
</span><span class="boring">
</span><span class="boring">        {
</span><span class="boring">            let thing = "foo".into_pyobject(py)?;
</span><span class="boring">            let rust_thing: RustyEnum = thing.extract()?;
</span><span class="boring">
</span><span class="boring">            assert_eq!(
</span><span class="boring">                "foo",
</span><span class="boring">                match rust_thing {
</span><span class="boring">                    RustyEnum::String(i) =&gt; i,
</span><span class="boring">                    other =&gt; unreachable!("Error extracting: {:?}", other),
</span><span class="boring">                }
</span><span class="boring">            );
</span><span class="boring">        }
</span><span class="boring">
</span><span class="boring">        {
</span><span class="boring">            let thing = b"foo".into_pyobject(py)?;
</span><span class="boring">            let error = thing.extract::&lt;RustyEnum&gt;().unwrap_err();
</span><span class="boring">            assert!(error.is_instance_of::&lt;pyo3::exceptions::PyTypeError&gt;(py));
</span><span class="boring">        }
</span><span class="boring">
</span><span class="boring">        Ok(())
</span><span class="boring">    })
</span><span class="boring">}</span></code></pre>
<p>If the input is neither a string nor an integer, the error message will be: <code>"'&lt;INPUT_TYPE&gt;' is not an instance of 'str | int'"</code>.</p>
<h3 id="derivefrompyobject-container-attributes"><a class="header" href="#derivefrompyobject-container-attributes"><code>#[derive(FromPyObject)]</code> Container Attributes</a></h3>
<ul>
<li><code>pyo3(transparent)</code>
<ul>
<li>extract the field directly from the object as <code>obj.extract()</code> instead of <code>get_item()</code> or
<code>getattr()</code></li>
<li>Newtype structs and tuple-variants are treated as transparent per default.</li>
<li>only supported for single-field structs and enum variants</li>
</ul>
</li>
<li><code>pyo3(annotation = "name")</code>
<ul>
<li>changes the name of the failed variant in the generated error message in case of failure.</li>
<li>e.g. <code>pyo3("int")</code> reports the variant’s type as <code>int</code>.</li>
<li>only supported for enum variants</li>
</ul>
</li>
<li><code>pyo3(rename_all = "...")</code>
<ul>
<li>renames all attributes/item keys according to the specified renaming rule</li>
<li>Possible values are: “camelCase”, “kebab-case”, “lowercase”, “PascalCase”, “SCREAMING-KEBAB-CASE”, “SCREAMING_SNAKE_CASE”, “snake_case”, “UPPERCASE”.</li>
<li>fields with an explicit renaming via <code>attribute(...)</code>/<code>item(...)</code> are not affected</li>
</ul>
</li>
</ul>
<h3 id="derivefrompyobject-field-attributes"><a class="header" href="#derivefrompyobject-field-attributes"><code>#[derive(FromPyObject)]</code> Field Attributes</a></h3>
<ul>
<li><code>pyo3(attribute)</code>, <code>pyo3(attribute("name"))</code>
<ul>
<li>retrieve the field from an attribute, possibly with a custom name specified as an argument</li>
<li>argument must be a string-literal.</li>
</ul>
</li>
<li><code>pyo3(item)</code>, <code>pyo3(item("key"))</code>
<ul>
<li>retrieve the field from a mapping, possibly with the custom key specified as an argument.</li>
<li>can be any literal that implements <code>ToBorrowedObject</code></li>
</ul>
</li>
<li><code>pyo3(from_py_with = ...)</code>
<ul>
<li>apply a custom function to convert the field from Python the desired Rust type.</li>
<li>the argument must be the path to the function.</li>
<li>the function signature must be <code>fn(&amp;Bound&lt;PyAny&gt;) -&gt; PyResult&lt;T&gt;</code> where <code>T</code> is the Rust type of the argument.</li>
</ul>
</li>
<li><code>pyo3(default)</code>, <code>pyo3(default = ...)</code>
<ul>
<li>if the argument is set, uses the given default value.</li>
<li>in this case, the argument must be a Rust expression returning a value of the desired Rust type.</li>
<li>if the argument is not set, <a href="https://doc.rust-lang.org/std/default/trait.Default.html#tymethod.default"><code>Default::default</code></a> is used.</li>
<li>note that the default value is only used if the field is not set.
If the field is set and the conversion function from Python to Rust fails, an exception is raised and the default value is not used.</li>
<li>this attribute is only supported on named fields.</li>
</ul>
</li>
</ul>
<p>For example, the code below applies the given conversion function on the <code>"value"</code> dict item to compute its length or fall back to the type default value (0):</p>
<pre><code class="language-rust">use pyo3::prelude::*;

#[derive(FromPyObject)]
struct RustyStruct {
    #[pyo3(item("value"), default, from_py_with = Bound::&lt;'_, PyAny&gt;::len)]
    len: usize,
    #[pyo3(item)]
    other: usize,
}
<span class="boring">
</span><span class="boring">use pyo3::types::PyDict;
</span><span class="boring">fn main() -&gt; PyResult&lt;()&gt; {
</span><span class="boring">    Python::attach(|py| -&gt; PyResult&lt;()&gt; {
</span><span class="boring">        // Filled case
</span><span class="boring">        let dict = PyDict::new(py);
</span><span class="boring">        dict.set_item("value", (1,)).unwrap();
</span><span class="boring">        dict.set_item("other", 1).unwrap();
</span><span class="boring">        let result = dict.extract::&lt;RustyStruct&gt;()?;
</span><span class="boring">        assert_eq!(result.len, 1);
</span><span class="boring">        assert_eq!(result.other, 1);
</span><span class="boring">
</span><span class="boring">        // Empty case
</span><span class="boring">        let dict = PyDict::new(py);
</span><span class="boring">        dict.set_item("other", 1).unwrap();
</span><span class="boring">        let result = dict.extract::&lt;RustyStruct&gt;()?;
</span><span class="boring">        assert_eq!(result.len, 0);
</span><span class="boring">        assert_eq!(result.other, 1);
</span><span class="boring">        Ok(())
</span><span class="boring">    })
</span><span class="boring">}</span></code></pre>
<h3 id="-phase-out-of-frompyobject-blanket-implementation-for-cloneable-pyclasses-"><a class="header" href="#-phase-out-of-frompyobject-blanket-implementation-for-cloneable-pyclasses-">⚠ Phase-Out of <code>FromPyObject</code> blanket implementation for cloneable PyClasses ⚠</a></h3>
<p>Historically PyO3 has provided a blanket implementation for <code>#[pyclass]</code> types that also implement <code>Clone</code>, to allow extraction of such types by value.
Over time this has turned out problematic for a few reasons, the major one being the prevention of custom conversions by downstream crates if their type is <code>Clone</code>.
Over the next few releases the blanket implementation is gradually phased out, and eventually replaced by an opt-in option.
As a first step of this migration a new <code>skip_from_py_object</code> option for <code>#[pyclass]</code> was introduced, to opt-out of the blanket implementation and allow downstream users to provide their own implementation:</p>
<pre><code class="language-rust"><span class="boring">#![allow(dead_code)]
</span><span class="boring">use pyo3::prelude::*;
</span>
#[pyclass(skip_from_py_object)] // opt-out of the PyO3 FromPyObject blanket
#[derive(Clone)]
struct Number(i32);

impl&lt;'py&gt; FromPyObject&lt;'_, 'py&gt; for Number {
    type Error = PyErr;

    fn extract(obj: pyo3::Borrowed&lt;'_, 'py, pyo3::PyAny&gt;) -&gt; Result&lt;Self, Self::Error&gt; {
        if let Ok(obj) = obj.cast::&lt;Self&gt;() { // first try extraction via class object
            Ok(obj.borrow().clone())
        } else {
            obj.extract::&lt;i32&gt;().map(Self) // otherwise try integer directly
        }
    }
}</code></pre>
<p>As a second step the <code>from_py_object</code> option was introduced.
This option also opts-out of the blanket implementation and instead generates a custom <code>FromPyObject</code> implementation for the pyclass which is functionally equivalent to the blanket.</p>
<h2 id="intopyobject"><a class="header" href="#intopyobject"><code>IntoPyObject</code></a></h2>
<p>The <a href="https://docs.rs/pyo3/0.28.1/pyo3/conversion/trait.IntoPyObject.html"><code>IntoPyObject</code></a> trait defines the to-python conversion for a Rust type.
All types in PyO3 implement this trait, as does a <code>#[pyclass]</code> which doesn’t use <code>extends</code>.</p>
<p>This trait defines a single method, <code>into_pyobject()</code>, which returns a <a href="https://doc.rust-lang.org/stable/std/result/enum.Result.html"><code>Result</code></a> with <code>Ok</code> and <code>Err</code> types depending on the input value.
For convenience, there is a companion <a href="https://docs.rs/pyo3/0.28.1/pyo3/conversion/trait.IntoPyObjectExt.html"><code>IntoPyObjectExt</code></a> trait which adds methods such as <code>into_py_any()</code> which converts the <code>Ok</code> and <code>Err</code> types to commonly used types (in the case of <code>into_py_any()</code>, <code>Py&lt;PyAny&gt;</code> and <code>PyErr</code> respectively).</p>
<p>Occasionally you may choose to implement this for custom types which are mapped to Python types <em>without</em> having a unique python type.</p>
<h3 id="derive-macro"><a class="header" href="#derive-macro">derive macro</a></h3>
<p><code>IntoPyObject</code> can be implemented using our derive macro.
Both <code>struct</code>s and <code>enum</code>s are supported.</p>
<p><code>struct</code>s will turn into a <code>PyDict</code> using the field names as keys, tuple <code>struct</code>s will turn convert into <code>PyTuple</code> with the fields in declaration order.</p>
<pre><code class="language-rust no_run"><span class="boring">#![allow(dead_code)]
</span><span class="boring">use pyo3::prelude::*;
</span><span class="boring">use std::collections::HashMap;
</span><span class="boring">use std::hash::Hash;
</span>
// structs convert into `PyDict` with field names as keys
#[derive(IntoPyObject)]
struct Struct {
    count: usize,
    obj: Py&lt;PyAny&gt;,
}

// tuple structs convert into `PyTuple`
// lifetimes and generics are supported, the impl will be bounded by
// `K: IntoPyObject, V: IntoPyObject`
#[derive(IntoPyObject)]
struct Tuple&lt;'a, K: Hash + Eq, V&gt;(&amp;'a str, HashMap&lt;K, V&gt;);</code></pre>
<p>For structs with a single field (newtype pattern) the <code>#[pyo3(transparent)]</code> option can be used to forward the implementation to the inner type.</p>
<pre><code class="language-rust no_run"><span class="boring">#![allow(dead_code)]
</span><span class="boring">use pyo3::prelude::*;
</span>
// newtype tuple structs are implicitly `transparent`
#[derive(IntoPyObject)]
struct TransparentTuple(Py&lt;PyAny&gt;);

#[derive(IntoPyObject)]
#[pyo3(transparent)]
struct TransparentStruct&lt;'py&gt; {
    inner: Bound&lt;'py, PyAny&gt;, // `'py` lifetime will be used as the Python lifetime
}</code></pre>
<p>For <code>enum</code>s each variant is converted according to the rules for <code>struct</code>s above.</p>
<pre><code class="language-rust no_run"><span class="boring">#![allow(dead_code)]
</span><span class="boring">use pyo3::prelude::*;
</span><span class="boring">use std::collections::HashMap;
</span><span class="boring">use std::hash::Hash;
</span>
#[derive(IntoPyObject)]
enum Enum&lt;'a, 'py, K: Hash + Eq, V&gt; { // enums are supported and convert using the same
    TransparentTuple(Py&lt;PyAny&gt;),       // rules on the variants as the structs above
    #[pyo3(transparent)]
    TransparentStruct { inner: Bound&lt;'py, PyAny&gt; },
    Tuple(&amp;'a str, HashMap&lt;K, V&gt;),
    Struct { count: usize, obj: Py&lt;PyAny&gt; }
}</code></pre>
<p>Additionally <code>IntoPyObject</code> can be derived for a reference to a struct or enum using the <code>IntoPyObjectRef</code> derive macro.
All the same rules from above apply as well.</p>
<h4 id="deriveintopyobjectderiveintopyobjectref-field-attributes"><a class="header" href="#deriveintopyobjectderiveintopyobjectref-field-attributes"><code>#[derive(IntoPyObject)]</code>/<code>#[derive(IntoPyObjectRef)]</code> Field Attributes</a></h4>
<ul>
<li><code>pyo3(into_py_with = ...)</code>
<ul>
<li>
<p>apply a custom function to convert the field from Rust into Python.</p>
</li>
<li>
<p>the argument must be the function identifier</p>
</li>
<li>
<p>the function signature must be <code>fn(Cow&lt;'_, T&gt;, Python&lt;'py&gt;) -&gt; PyResult&lt;Bound&lt;'py, PyAny&gt;&gt;</code> where <code>T</code> is the Rust type of the argument.</p>
<ul>
<li><code>#[derive(IntoPyObject)]</code> will invoke the function with <code>Cow::Owned</code></li>
<li><code>#[derive(IntoPyObjectRef)]</code> will invoke the function with <code>Cow::Borrowed</code></li>
</ul>
<pre><code class="language-rust no_run"><span class="boring">use pyo3::prelude::*;
</span><span class="boring">use pyo3::IntoPyObjectExt;
</span><span class="boring">use std::borrow::Cow;
</span>#[derive(Clone)]
struct NotIntoPy(usize);

#[derive(IntoPyObject, IntoPyObjectRef)]
struct MyStruct {
    #[pyo3(into_py_with = convert)]
    not_into_py: NotIntoPy,
}

/// Convert `NotIntoPy` into Python
fn convert&lt;'py&gt;(not_into_py: Cow&lt;'_, NotIntoPy&gt;, py: Python&lt;'py&gt;) -&gt; PyResult&lt;Bound&lt;'py, PyAny&gt;&gt; {
    not_into_py.0.into_bound_py_any(py)
}</code></pre>
</li>
</ul>
</li>
</ul>
<h3 id="manual-implementation"><a class="header" href="#manual-implementation">manual implementation</a></h3>
<p>If the derive macro is not suitable for your use case, <code>IntoPyObject</code> can be implemented manually as demonstrated below.</p>
<pre><code class="language-rust no_run"><span class="boring">use pyo3::prelude::*;
</span><span class="boring">#[allow(dead_code)]
</span>struct MyPyObjectWrapper(Py&lt;PyAny&gt;);

impl&lt;'py&gt; IntoPyObject&lt;'py&gt; for MyPyObjectWrapper {
    type Target = PyAny; // the Python type
    type Output = Bound&lt;'py, Self::Target&gt;; // in most cases this will be `Bound`
    type Error = std::convert::Infallible; // the conversion error type, has to be convertible to `PyErr`

    fn into_pyobject(self, py: Python&lt;'py&gt;) -&gt; Result&lt;Self::Output, Self::Error&gt; {
        Ok(self.0.into_bound(py))
    }
}

// equivalent to former `ToPyObject` implementations
impl&lt;'a, 'py&gt; IntoPyObject&lt;'py&gt; for &amp;'a MyPyObjectWrapper {
    type Target = PyAny;
    type Output = Borrowed&lt;'a, 'py, Self::Target&gt;; // `Borrowed` can be used to optimized reference counting
    type Error = std::convert::Infallible;

    fn into_pyobject(self, py: Python&lt;'py&gt;) -&gt; Result&lt;Self::Output, Self::Error&gt; {
        Ok(self.0.bind_borrowed(py))
    }
}</code></pre>
<h3 id="boundobject-for-conversions-that-may-be-bound-or-borrowed"><a class="header" href="#boundobject-for-conversions-that-may-be-bound-or-borrowed"><code>BoundObject</code> for conversions that may be <code>Bound</code> or <code>Borrowed</code></a></h3>
<p><code>IntoPyObject::into_py_object</code> returns either <code>Bound</code> or <code>Borrowed</code> depending on the implementation for a concrete type.
For example, the <code>IntoPyObject</code> implementation for <code>u32</code> produces a <code>Bound&lt;'py, PyInt&gt;</code> and the <code>bool</code> implementation produces a <code>Borrowed&lt;'py, 'py, PyBool&gt;</code>:</p>
<pre><code class="language-rust no_run">use pyo3::prelude::*;
use pyo3::IntoPyObject;
use pyo3::types::{PyBool, PyInt};

let ints: Vec&lt;u32&gt; = vec![1, 2, 3, 4];
let bools = vec![true, false, false, true];

Python::attach(|py| {
    let ints_as_pyint: Vec&lt;Bound&lt;'_, PyInt&gt;&gt; = ints
        .iter()
        .map(|x| Ok(x.into_pyobject(py)?))
        .collect::&lt;PyResult&lt;_&gt;&gt;()
        .unwrap();

    let bools_as_pybool: Vec&lt;Borrowed&lt;'_, '_, PyBool&gt;&gt; = bools
        .iter()
        .map(|x| Ok(x.into_pyobject(py)?))
        .collect::&lt;PyResult&lt;_&gt;&gt;()
        .unwrap();
});</code></pre>
<p>In this example if we wanted to combine <code>ints_as_pyints</code> and <code>bools_as_pybool</code> into a single <code>Vec&lt;Py&lt;PyAny&gt;&gt;</code> to return from the <code>Python::attach</code> closure, we would have to manually convert the concrete types for the smart pointers and the python types.</p>
<p>Instead, we can write a function that generically converts vectors of either integers or bools into a vector of <code>Py&lt;PyAny&gt;</code> using the <a href="https://docs.rs/pyo3/0.28.1/pyo3/instance/trait.BoundObject.html"><code>BoundObject</code></a> trait:</p>
<pre><code class="language-rust no_run"><span class="boring">use pyo3::prelude::*;
</span><span class="boring">use pyo3::BoundObject;
</span><span class="boring">use pyo3::IntoPyObject;
</span>
<span class="boring">let bools = vec![true, false, false, true];
</span><span class="boring">let ints = vec![1, 2, 3, 4];
</span>
fn convert_to_vec_of_pyobj&lt;'py, T&gt;(py: Python&lt;'py&gt;, the_vec: Vec&lt;T&gt;) -&gt; PyResult&lt;Vec&lt;Py&lt;PyAny&gt;&gt;&gt;
where
   T: IntoPyObject&lt;'py&gt; + Copy
{
    the_vec.iter()
        .map(|x| {
            Ok(
                // Note: the below is equivalent to `x.into_py_any()`
                // from the `IntoPyObjectExt` trait
                x.into_pyobject(py)
                .map_err(Into::into)?
                .into_any()
                .unbind()
            )
        })
        .collect()
}

let vec_of_pyobjs: Vec&lt;Py&lt;PyAny&gt;&gt; = Python::attach(|py| {
    let mut bools_as_pyany = convert_to_vec_of_pyobj(py, bools).unwrap();
    let mut ints_as_pyany = convert_to_vec_of_pyobj(py, ints).unwrap();
    let mut result: Vec&lt;Py&lt;PyAny&gt;&gt; = vec![];
    result.append(&amp;mut bools_as_pyany);
    result.append(&amp;mut ints_as_pyany);
    result
});</code></pre>
<p>In the example above we used <code>BoundObject::into_any</code> and <code>BoundObject::unbind</code> to manipulate the python types and smart pointers into the result type we wanted to produce from the function.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../conversions/tables.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="../async-await.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../conversions/tables.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="../async-await.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../mark-09e88c2c.min.js"></script>
        <script src="../searcher-c2a407aa.js"></script>

        <script src="../clipboard-1626706a.min.js"></script>
        <script src="../highlight-abc7f01d.js"></script>
        <script src="../book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->
        <script src="../theme/tabs-6977231d.js"></script>



    </div>
    </body>
</html>
